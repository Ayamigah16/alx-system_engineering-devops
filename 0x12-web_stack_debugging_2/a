#!/usr/bin/env bash
# This script configures Nginx to run as the nginx user and listen on port 8080

# Check if nginx is already installed
if ! command -v nginx &>/dev/null; then
    echo "Nginx is not installed. Please install it first."
    exit 1
fi

# Backup the original nginx.conf file
cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.orig

# Replace the user directive in nginx.conf with nginx user
sed -i 's/^user .*;/user nginx;/g' /etc/nginx/nginx.conf

# Remove the default server block configuration
rm /etc/nginx/sites-enabled/default

# Create a new server block configuration
cat << EOF > /etc/nginx/sites-enabled/default
server {
    listen 8080 default_server;
    listen [::]:8080 default_server;
    root /var/www/html;
    index index.html index.htm index.nginx-debian.html;
    server_name _;
    location / {
        try_files \$uri \$uri/ =404;
    }
}
EOF

# Restart Nginx to apply the changes
service nginx restart
